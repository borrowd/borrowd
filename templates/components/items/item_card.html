{% comment %}
Item Card Component

A horizontal card layout for displaying items with contextual headers and inline action buttons.

Parameters:
- pk: Item ID
- name: Title
- description: Description text
- image: Thumbnail URL
- is_yours: Boolean - show "Yours" badge
- banner_type: 'request' | 'available' | 'reserved' | none
- requester_name: For request banner
- time_ago: For request banner ("2h ago")
- item: Item object (for HTMX URLs)
- action_context: ItemActionContext with .actions and .status_text (from get_action_context_for)
- show_actions: Boolean - render action buttons
- variant: 'default' | 'compact'

 {% if variant == 'compact' %}max-w-sm{% else %}w-[18rem] h-[9.375rem]{% endif %}

{% endcomment %}
{% load static %}
{% firstof card_id "item-card-"|add:context|add:"-"|add:pk as card_id %}
{% firstof modal_suffix "-"|add:context|add:"-"|add:pk as modal_suffix %}
{% firstof actions_container_id "item-card-actions-"|add:context|add:"-"|add:pk as actions_container_id %}
{% firstof card_id_selector "#item-card-"|add:context|add:"-"|add:pk as card_id_selector %}
{% firstof request_modal_id "request-item-modal-"|add:context|add:"-"|add:pk as request_modal_id %}
{% firstof accept_modal_id "accept-request-modal-"|add:context|add:"-"|add:pk as accept_modal_id %}
<div id="{{ card_id }}"
     hx-get="{% url 'item-card' pk %}?context={{ context }}"
     hx-trigger="item-updated-{{ pk }} from:body"
     hx-swap="outerHTML"
     class="bg-white rounded-lg shadow-md overflow-hidden w-72 min-h-48">
    {% if banner_type %}
        {% include "components/items/item_card_header.html" with banner_type=banner_type requester_name=requester_name time_ago=time_ago %}
    {% endif %}

    <div class="flex-col p-4">
        <div class="flex gap-3 flex-row items-top p-3">
            <!-- Thumbnail -->
            <div class="relative">
                <a href="{% url 'item-detail' pk %}" class="block no-underline min-w-0 flex-1">
                    <img
                        src="{{ image|default:'/static/items/categories/logo-tools.png' }}"
                        alt="{{ name|default:'Item image' }}"
                        class="w-32 h-32 object-cover rounded-lg"
                    />
                </a>
            </div>

            <!-- Content -->
            <div class="flex-col">
                <a href="{% url 'item-detail' pk %}">
                    <div class="mb-2">
                        {% if is_yours %}
                            <div class="rounded-4xl h-xs max-w-xs w-fit p-1 pl-2 pr-2 bg-gray-100 border-solid border-2 border-gray-200">
                                <span class="text-sm text-gray-900 text-center">Yours</span>
                            </div>
                        {% endif %}
                    </div>
                    <h3 class="text-base font-semibold text-gray-900 wrap">{{ name }}</h3>
                    <p class="text-sm text-gray-900 line-clamp-2 mt-1 wrap overflow-clip">{{ description }}</p>
                </a>
            </div>
        </div>
        {% if show_actions and action_context.actions %}
            {% include "components/items/action_buttons_with_status.html" with item=item action_context=action_context variant="card" container_id=actions_container_id swap_target_id=card_id modal_suffix=modal_suffix %}
        {% endif %}
    </div>

    {% if show_actions %}
        {% include "components/items/accept_request_modal.html" with item=item card_id_selector=card_id_selector modal_id=accept_modal_id %}
        {% include "components/items/request_item_modal.html" with item=item card_id_selector=card_id_selector modal_id=request_modal_id %}
    {% endif %}
</div>
