{% comment %}
Item Card Component

A horizontal card layout for displaying items with contextual headers and inline action buttons.

Parameters:
- pk: Item ID
- name: Title
- description: Description text
- image: Thumbnail URL
- is_yours: Boolean - show "Yours" badge
- banner_type: 'request' | 'available' | 'reserved' | none
- requester_name: For request banner
- time_ago: For request banner ("2h ago")
- item: Item object (for HTMX URLs)
- action_context: ItemActionContext with .actions and .status_text (from get_action_context_for)
- show_actions: Boolean - render action buttons
- variant: 'default' | 'compact'

 {% if variant == 'compact' %}max-w-sm{% else %}w-[18rem] h-[9.375rem]{% endif %}

{% endcomment %}
{% load static %}
<div id="item-card-{{ pk }}" class="bg-white rounded-lg shadow-md overflow-hidden w-72">
    {% if banner_type %}
        {% include "components/items/item_card_header.html" with banner_type=banner_type requester_name=requester_name time_ago=time_ago %}
    {% endif %}

    <div class="flex-col p-4">
        <div class="flex gap-3 flex-row items-top p-3">
            <!-- Thumbnail -->
            <a href="{% url 'item-detail' pk %}" class="flex-shrink-0">
                <div class="relative">
                    <img
                        src="{{ image|default:'/static/items/categories/logo-tools.png' }}"
                        alt="{{ name|default:'Item image' }}"
                        class="w-32 h-32 object-cover rounded-lg"
                    />
                </div>
            </a>

            <!-- Content -->
            <div class="flex-1 min-w-0 flex flex-col">
                <div class="flex items-start justify-between gap-2">
                    <a href="{% url 'item-detail' pk %}" class="block no-underline min-w-0 flex-1">
                        <h3 class="text-base font-semibold text-gray-900 wrap">{{ name }}</h3>
                        <p class="text-sm text-gray-600 line-clamp-2 mt-1 wrap">{{ description }}</p>
                    </a>
                </div>
            </div>
        </div>
        {% if show_actions and action_context.actions %}
            {% include "components/items/item_card_actions.html" with item=item action_context=action_context %}
        {% endif %}
    </div>

    {% if show_actions %}
        <!-- Modal for Accept Request -->
        {% include "components/modal.html" with modal_id="accept-request-modal-"|add:pk modal_title="Accept Request" button_layout="equal" confirm_button="Agree" cancel_button="Decline" cancel_button_class="btn btn-soft btn-error font-semibold" confirm_button_class="btn btn-soft btn-success font-semibold" confirm_action="confirmAcceptRequest"|add:pk|add:"()" modal_content="<p>Let's lend with care!</p><p class='mt-2 text-sm'>We keep our community strong by lending responsibly. Please confirm you agree to:</p><ul class='list-none list-inside mt-2 text-sm'><li><a href='https://borrowd.org/borrower-lender-agreement/' target='_blank' class='underline'>Borrower–Lender Liability Agreement</a> (keeps us safe)</li><li><a href='https://borrowd.org/code-of-conduct/' target='_blank' class='underline'>Borrow'd Code of Conduct</a> (keeps trust strong)</li></ul>" %}

        <!-- Modal for Request Item -->
        {% include "components/modal.html" with modal_id="request-item-modal-"|add:pk modal_title="Confirm Request" button_layout="equal" confirm_button="Agree" cancel_button="Decline" cancel_button_class="btn btn-soft btn-error font-semibold" confirm_button_class="btn btn-soft btn-success font-semibold" confirm_action="confirmRequestItem"|add:pk|add:"()" modal_content="<p>Let's share with care!</p><p class='mt-2 text-sm'>We keep our community strong by lending responsibly. Please confirm you agree to:</p><ul class='list-none list-inside mt-2 text-sm'><li><a href='https://borrowd.org/borrower-lender-agreement/' target='_blank' class='underline'>Borrower–Lender Liability Agreement</a> (keeps us safe)</li><li><a href='https://borrowd.org/code-of-conduct/' target='_blank' class='underline'>Borrow'd Code of Conduct</a> (keeps trust strong)</li></ul>" %}

        <script>
        function confirmAcceptRequest{{ pk }}() {
            closeModal('accept-request-modal-{{ pk }}');
            htmx.ajax('POST', '{% url 'item-borrow' pk %}', {
                values: {'action': 'ACCEPT_REQUEST'},
                swap: 'innerHTML',
                target: '#item-card-actions-{{ pk }}'
            });
        }

        function confirmRequestItem{{ pk }}() {
            closeModal('request-item-modal-{{ pk }}');
            htmx.ajax('POST', '{% url 'item-borrow' pk %}', {
                values: {'action': 'REQUEST_ITEM'},
                swap: 'innerHTML',
                target: '#item-card-actions-{{ pk }}'
            });
        }
        </script>
    {% endif %}
</div>
