{% extends "items/layout.html" %}

{% comment %}
    This template is used for both creating and editing.
    Checking `view.object.pk` is strangely the best way to check
    if we are creating or editing.
{% endcomment %}
{% block head_title %}{% if not view.object.pk %}Create{% else %}Edit{% endif %} Item{% endblock %}

{% block items_content %}
<c-box>
    <c-h1>{% if not view.object.pk %}Create{% else %}Edit{% endif %} Item</c-h1>
    <form method="post" enctype="multipart/form-data" class="flex flex-col space-y-2" onsubmit="this.querySelector('button[type=submit]').disabled = true;">
        {% csrf_token %}
        {% for field in form %}
        <div class="fieldset w-full">
            <label class="label">
                <span class="label-text ">{{ field.label }}</span>
                {% if field.name == "trust_level_required" %}
                    <a href="javascript:void(0)" onclick="showModal('trust-level-info-modal')" class="label-text-alt text-blue-600 hover:text-blue-800 underline ml-2">What is this?</a>
                {% endif %}
            </label>
            {{ field }}
            {% if field.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ field.errors }}</span>
                </label>
            {% endif %}
        </div>
        {% endfor %}

        {% if view.object.pk %}
            <b>Photos:</b>
            {% if view.object.photos.all %}
                <c-gallery>
                {% for photo in view.object.photos.all %}
                    <div>
                        <c-photo src="{{ photo.image.url }}"
                            alt="{{ view.object.name }} Photo {{ forloop.counter }}" />
                        <div class="p-1 flex justify-center">
                            <c-button-nav url="{% url 'itemphoto-delete' view.object.pk photo.pk %}">
                                Delete
                            </c-button-nav>
                        </div>
                    </div>
                {% endfor %}
                </c-gallery>
            {% else %}
                <div class="mb-2">No photos</div>
            {% endif %}
            {% if view.object.photos.count < 5 %}
                <c-button-nav url="{% url 'itemphoto-create' form.instance.pk %}">Add Photo</c-button-nav>
            {% else %}
                <div class="text-gray-500 italic">Photo limit (5) reached. Delete a photo if you want to add another.</div>
            {% endif %}

        {% endif %}

        <div class="">
            <c-button type="submit" class="btn btn-primary">Save item</c-button>
            {% if form.instance.pk %}
                <c-button-nav url="{% url 'item-detail' form.instance.pk %}">
                    Cancel
                </c-button-nav>
                <c-button-nav url="{% url 'item-delete' form.instance.pk %}">
                    Delete
                </c-button-nav>
            {% endif %}
        </div>
    </form>
</c-box>

{% include "components/modal.html" with modal_id="trust-level-info-modal" modal_title="Group trust levels" cancel_button="Got it" modal_content="<p>At the heart of Borrow'd is trust. Each group you join gets a trust level (High, Medium, or Low), which determines what kinds of items they can request from you. For example:</p><h2 class='font-bold mt-4 mb-2'>High trust: Super Best Friends</h2><p>A small circle of people you've known for years. You trust them with your life â€“ and also, electronics, appliances, and other high-value items.</p><h2 class='font-bold mt-4 mb-2'>Medium trust: Sports Ball Team</h2><p>You may have only known each other for a few seasons, but you know you can count on them to score points (and return your items). You're comfortable sharing things like hobby tools or gardening supplies.</p><h2 class='font-bold mt-4 mb-2'>Low trust: Neighborhood Community</h2><p>You recognize your neighbors, but don't necessarily see each other often. You're happy to lend out low-cost, hard-to-break items like books, toys, or decorations.</p>" %}
{% endblock %}
